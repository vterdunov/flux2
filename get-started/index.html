
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Open and extensible continuous delivery solution for Kubernetes">
      
      
      
        <link rel="canonical" href="https://toolkit.fluxcd.io/get-started/">
      
      
        <meta name="author" content="The Flux project">
      
      <link rel="shortcut icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.7">
    
    
      
        <title>Get Started - Flux | GitOps Toolkit</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.19753c6b.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.196e0c26.min.css">
        
          
          
          <meta name="theme-color" content="#2094f3">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../_static/custom.css">
    
    
      
    
    

<meta property="og:url" content="https://toolkit.fluxcd.io/get-started/">

<meta property="og:title" content="Get Started - Flux | GitOps Toolkit">

<meta property="og:description" content="Open and extensible continuous delivery solution for Kubernetes">
<meta property="og:image" content="https://toolkit.fluxcd.io/_files/toolkit-icon.png">
<meta property="og:image:alt" content="GitOps Toolkit">
<meta property="og:image:type" content="image/png">

<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@stefanprodan">
<meta name="twitter:creator" content="@stefanprodan">

<meta property="twitter:title" content="Get Started - Flux | GitOps Toolkit">

<meta name="twitter:description" content="Open and extensible continuous delivery solution for Kubernetes">
<meta name="twitter:image" content="https://toolkit.fluxcd.io/_files/toolkit-icon.png">
<meta name="twitter:image:alt" content="GitOps Toolkit">


  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="blue" data-md-color-accent="indigo">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#get-started-with-flux-v2" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://toolkit.fluxcd.io" title="Flux | GitOps Toolkit" class="md-header-nav__button md-logo" aria-label="Flux | GitOps Toolkit">
      
  <img src="../_files/flux-icon@2x.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Flux | GitOps Toolkit
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Get Started
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/fluxcd/flux2" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    fluxcd/flux2
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://toolkit.fluxcd.io" title="Flux | GitOps Toolkit" class="md-nav__button md-logo" aria-label="Flux | GitOps Toolkit">
      
  <img src="../_files/flux-icon@2x.png" alt="logo">

    </a>
    Flux | GitOps Toolkit
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/fluxcd/flux2" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    fluxcd/flux2
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Get Started
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Get Started
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-flux-cli" class="md-nav__link">
    Install the Flux CLI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gitops-workflow" class="md-nav__link">
    GitOps workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#staging-bootstrap" class="md-nav__link">
    Staging bootstrap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#staging-workflow" class="md-nav__link">
    Staging workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-bootstrap" class="md-nav__link">
    Production bootstrap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-workflow" class="md-nav__link">
    Production workflow
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
    <label class="md-nav__link" for="nav-3">
      Guides
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Guides" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon"></span>
        Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/installation/" class="md-nav__link">
      Installation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/helmreleases/" class="md-nav__link">
      Manage Helm Releases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/notifications/" class="md-nav__link">
      Setup Notifications
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/webhook-receivers/" class="md-nav__link">
      Setup Webhook Receivers
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/monitoring/" class="md-nav__link">
      Monitoring with Prometheus
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/sealed-secrets/" class="md-nav__link">
      Sealed Secrets
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/mozilla-sops/" class="md-nav__link">
      Mozilla SOPS
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/image-update/" class="md-nav__link">
      Automate image updates to Git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3-9" type="checkbox" id="nav-3-9" >
    <label class="md-nav__link" for="nav-3-9">
      Migration
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Migration" data-md-level="2">
      <label class="md-nav__title" for="nav-3-9">
        <span class="md-nav__icon md-icon"></span>
        Migration
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/flux-v1-migration/" class="md-nav__link">
      Migrate from Flux v1
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../guides/helm-operator-migration/" class="md-nav__link">
      Migrate from the Helm Operator
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4" >
    <label class="md-nav__link" for="nav-4">
      Toolkit Components
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Toolkit Components" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon"></span>
        Toolkit Components
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../components/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-2" type="checkbox" id="nav-4-2" >
    <label class="md-nav__link" for="nav-4-2">
      Source Controller
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Source Controller" data-md-level="2">
      <label class="md-nav__title" for="nav-4-2">
        <span class="md-nav__icon md-icon"></span>
        Source Controller
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../components/source/controller/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/source/gitrepositories/" class="md-nav__link">
      GitRepository CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/source/helmrepositories/" class="md-nav__link">
      HelmRepository CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/source/helmcharts/" class="md-nav__link">
      HelmChart CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/source/buckets/" class="md-nav__link">
      Bucket CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/source/api/" class="md-nav__link">
      Source API Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-3" type="checkbox" id="nav-4-3" >
    <label class="md-nav__link" for="nav-4-3">
      Kustomize Controller
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Kustomize Controller" data-md-level="2">
      <label class="md-nav__title" for="nav-4-3">
        <span class="md-nav__icon md-icon"></span>
        Kustomize Controller
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../components/kustomize/controller/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/kustomize/kustomization/" class="md-nav__link">
      Kustomization CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/kustomize/api/" class="md-nav__link">
      Kustomize API Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-4" type="checkbox" id="nav-4-4" >
    <label class="md-nav__link" for="nav-4-4">
      Helm Controller
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Helm Controller" data-md-level="2">
      <label class="md-nav__title" for="nav-4-4">
        <span class="md-nav__icon md-icon"></span>
        Helm Controller
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../components/helm/controller/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/helm/helmreleases/" class="md-nav__link">
      HelmRelease CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/helm/api/" class="md-nav__link">
      Helm API Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4-5" type="checkbox" id="nav-4-5" >
    <label class="md-nav__link" for="nav-4-5">
      Notification Controller
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Notification Controller" data-md-level="2">
      <label class="md-nav__title" for="nav-4-5">
        <span class="md-nav__icon md-icon"></span>
        Notification Controller
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../components/notification/controller/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/notification/event/" class="md-nav__link">
      Event
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/notification/provider/" class="md-nav__link">
      Provider CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/notification/alert/" class="md-nav__link">
      Alert CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/notification/receiver/" class="md-nav__link">
      Receiver CRD
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/notification/api/" class="md-nav__link">
      Notification API Reference
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" >
    <label class="md-nav__link" for="nav-5">
      Flux CLI
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Flux CLI" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon"></span>
        Flux CLI
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux/" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_bootstrap/" class="md-nav__link">
      Bootstrap
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_bootstrap_github/" class="md-nav__link">
      Bootstrap github
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_bootstrap_gitlab/" class="md-nav__link">
      Bootstrap gitlab
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_check/" class="md-nav__link">
      Check
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create/" class="md-nav__link">
      Create
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_kustomization/" class="md-nav__link">
      Create kustomization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_helmrelease/" class="md-nav__link">
      Create helmrelease
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_source/" class="md-nav__link">
      Create source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_source_git/" class="md-nav__link">
      Create source git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_source_helm/" class="md-nav__link">
      Create source helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_source_bucket/" class="md-nav__link">
      Create source bucket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_alert-provider/" class="md-nav__link">
      Create alert provider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_alert/" class="md-nav__link">
      Create alert
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_receiver/" class="md-nav__link">
      Create receiver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_tenant/" class="md-nav__link">
      Create tenant
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_secret/" class="md-nav__link">
      Create secret
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_create_secret_git/" class="md-nav__link">
      Create secret git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_delete/" class="md-nav__link">
      Delete
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_delete_kustomization/" class="md-nav__link">
      Delete kustomization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_delete_helmrelease/" class="md-nav__link">
      Delete helmrelease
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_delete_source/" class="md-nav__link">
      Delete source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_delete_source_git/" class="md-nav__link">
      Delete source git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_delete_source_helm/" class="md-nav__link">
      Delete source helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_delete_source_bucket/" class="md-nav__link">
      Delete source bucket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export/" class="md-nav__link">
      Export
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_kustomization/" class="md-nav__link">
      Export kustomization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_helmrelease/" class="md-nav__link">
      Export helmrelease
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_source/" class="md-nav__link">
      Export source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_source_git/" class="md-nav__link">
      Export source git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_source_helm/" class="md-nav__link">
      Export source helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_source_bucket/" class="md-nav__link">
      Export source bucket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_alert-provider/" class="md-nav__link">
      Export alert provider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_alert/" class="md-nav__link">
      Export alert
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_export_receiver/" class="md-nav__link">
      Export receiver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get/" class="md-nav__link">
      Get
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_kustomizations/" class="md-nav__link">
      Get kustomizations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_helmreleases/" class="md-nav__link">
      Get helmreleases
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_sources/" class="md-nav__link">
      Get sources
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_sources_git/" class="md-nav__link">
      Get sources git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_sources_helm/" class="md-nav__link">
      Get sources helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_sources_chart/" class="md-nav__link">
      Get sources chart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_sources_bucket/" class="md-nav__link">
      Get sources bucket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_alert-provider.md" class="md-nav__link">
      Get alert provider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_alert.md" class="md-nav__link">
      Get alert
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_get_receiver.md" class="md-nav__link">
      Get receiver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_install/" class="md-nav__link">
      Install
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume/" class="md-nav__link">
      Resume
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_kustomization/" class="md-nav__link">
      Resume kustomization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_helmrelease/" class="md-nav__link">
      Resume helmrelease
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_source/" class="md-nav__link">
      Resume source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_source_git/" class="md-nav__link">
      Resume source git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_source_helm/" class="md-nav__link">
      Resume source helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_source_chart/" class="md-nav__link">
      Resume source chart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_source_bucket/" class="md-nav__link">
      Resume source bucket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_alert-provider.md" class="md-nav__link">
      Resume alert provider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_alert/" class="md-nav__link">
      Resume alert
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_resume_receiver/" class="md-nav__link">
      Resume receiver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend/" class="md-nav__link">
      Suspend
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_kustomization/" class="md-nav__link">
      Suspend kustomization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_helmrelease/" class="md-nav__link">
      Suspend helmrelease
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_source/" class="md-nav__link">
      Suspend source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_source_git/" class="md-nav__link">
      Suspend source git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_source_helm/" class="md-nav__link">
      Suspend source helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_source_chart/" class="md-nav__link">
      Suspend source chart
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_source_bucket/" class="md-nav__link">
      Suspend source bucket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_alert-provider.md" class="md-nav__link">
      Suspend alert provider
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_alert/" class="md-nav__link">
      Suspend alert
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_suspend_receiver/" class="md-nav__link">
      Suspend receiver
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_reconcile/" class="md-nav__link">
      Reconcile
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_reconcile_kustomization/" class="md-nav__link">
      Reconcile kustomization
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_reconcile_helmrelease/" class="md-nav__link">
      Reconcile helmrelease
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_reconcile_source/" class="md-nav__link">
      Reconcile source
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_reconcile_source_git/" class="md-nav__link">
      Reconcile source git
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_reconcile_source_helm/" class="md-nav__link">
      Reconcile source helm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_reconcile_source_bucket/" class="md-nav__link">
      Reconcile source bucket
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../cmd/flux_uninstall/" class="md-nav__link">
      Uninstall
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" >
    <label class="md-nav__link" for="nav-6">
      Dev Guides
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="Dev Guides" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon"></span>
        Dev Guides
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../dev-guides/source-watcher/" class="md-nav__link">
      Watching for source changes
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../roadmap/" class="md-nav__link">
      Roadmap
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../contributing/" class="md-nav__link">
      Contributing
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../faq/" class="md-nav__link">
      FAQ
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-flux-cli" class="md-nav__link">
    Install the Flux CLI
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gitops-workflow" class="md-nav__link">
    GitOps workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#staging-bootstrap" class="md-nav__link">
    Staging bootstrap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#staging-workflow" class="md-nav__link">
    Staging workflow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-bootstrap" class="md-nav__link">
    Production bootstrap
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#production-workflow" class="md-nav__link">
    Production workflow
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="get-started-with-flux-v2">Get started with Flux v2<a class="headerlink" href="#get-started-with-flux-v2" title="Permanent link">&para;</a></h1>
<h2 id="prerequisites">Prerequisites<a class="headerlink" href="#prerequisites" title="Permanent link">&para;</a></h2>
<p>You will need two Kubernetes clusters version 1.16 or newer and kubectl version 1.18.
For a quick local test, you can use <a href="https://kind.sigs.k8s.io/docs/user/quick-start/">Kubernetes kind</a>.
Any other Kubernetes setup will work as well though.</p>
<p>In order to follow the guide you'll need a GitHub account and a
<a href="https://help.github.com/en/github/authenticating-to-github/creating-a-personal-access-token-for-the-command-line">personal access token</a>
that can create repositories (check all permissions under <code>repo</code>).</p>
<p>Export your GitHub personal access token and username:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">GITHUB_TOKEN</span><span class="o">=</span>&lt;your-token&gt;
<span class="nb">export</span> <span class="nv">GITHUB_USER</span><span class="o">=</span>&lt;your-username&gt;
</code></pre></div>
<h2 id="install-the-flux-cli">Install the Flux CLI<a class="headerlink" href="#install-the-flux-cli" title="Permanent link">&para;</a></h2>
<p>To install the latest <code>flux</code> release on MacOS and Linux using
<a href="https://brew.sh/">Homebrew</a> run:</p>
<div class="highlight"><pre><span></span><code>brew install fluxcd/tap/flux
</code></pre></div>
<p>Or install <code>flux</code> by downloading precompiled binaries using a Bash script:</p>
<div class="highlight"><pre><span></span><code>curl -s https://toolkit.fluxcd.io/install.sh <span class="p">|</span> sudo bash
</code></pre></div>
<p>The install script downloads the flux binary to <code>/usr/local/bin</code>.</p>
<p>If using Arch Linux, install the latest stable version from <strong>AUR</strong> using
either <a href="https://aur.archlinux.org/packages/flux-bin">flux-bin</a> (pre-built
binary) or <a href="https://aur.archlinux.org/packages/flux-go">flux-go</a> (locally built
binary).</p>
<p>Binaries for <strong>macOS</strong>, <strong>Windows</strong> and <strong>Linux</strong> AMD64/ARM are available for download on the
<a href="https://github.com/fluxcd/flux2/releases">release page</a>.</p>
<p>To configure your shell to load <code>flux</code> completions add to your Bash
profile:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># ~/.bashrc or ~/.bash_profile</span>
. &lt;<span class="o">(</span>flux completion bash<span class="o">)</span>
</code></pre></div>
<p><code>zsh</code>, <code>fish</code>, and <code>powershell</code> are also supported with their own sub-commands.</p>
<h2 id="gitops-workflow">GitOps workflow<a class="headerlink" href="#gitops-workflow" title="Permanent link">&para;</a></h2>
<p>You'll be using a dedicated Git repository e.g. <code>fleet-infra</code> to manage one or more Kubernetes clusters.
This guide assumes that you have two clusters, one for staging and one for production.</p>
<p>Using the Flux CLI you'll do the following:</p>
<ul>
<li>configure each cluster to synchronise with a directory inside the fleet repository</li>
<li>register app sources (git repositories) that contain plain Kubernetes manifests or Kustomize overlays</li>
<li>configure app deployments on both clusters (pre-releases on staging, semver releases on production)</li>
</ul>
<h2 id="staging-bootstrap">Staging bootstrap<a class="headerlink" href="#staging-bootstrap" title="Permanent link">&para;</a></h2>
<p>Create the staging cluster using Kubernetes kind or set the kubectl context to an existing cluster:</p>
<div class="highlight"><pre><span></span><code>kind create cluster --name staging
kubectl cluster-info --context kind-staging
</code></pre></div>
<p>Verify that your staging cluster satisfies the prerequisites with:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> flux check --pre
<span class="go">► checking prerequisites</span>
<span class="go">✔ kubectl 1.18.3 &gt;=1.18.0</span>
<span class="go">✔ kubernetes 1.18.2 &gt;=1.16.0</span>
<span class="go">✔ prerequisites checks passed</span>
</code></pre></div>
<p>Run the bootstrap command:</p>
<div class="highlight"><pre><span></span><code>flux bootstrap github <span class="se">\</span>
  --owner<span class="o">=</span><span class="nv">$GITHUB_USER</span> <span class="se">\</span>
  --repository<span class="o">=</span>fleet-infra <span class="se">\</span>
  --branch<span class="o">=</span>main <span class="se">\</span>
  --path<span class="o">=</span>staging-cluster <span class="se">\</span>
  --personal
</code></pre></div>
<div class="admonition hint">
<p class="admonition-title">ARM</p>
<p>When deploying to a Kubernetes cluster with ARM architecture,
you can use <code>--arch=arm</code> for ARMv7 32-bit container images
and <code>--arch=arm64</code> for ARMv8 64-bit container images.</p>
</div>
<p>The bootstrap command creates a repository if one doesn't exist, and
commits the manifests for the Flux components to the default branch at the specified path.
Then it configures the target cluster to synchronize with the specified path inside the repository.</p>
<p>If you wish to create the repository under a GitHub organization:</p>
<div class="highlight"><pre><span></span><code>flux bootstrap github <span class="se">\</span>
  --owner<span class="o">=</span>&lt;organization&gt; <span class="se">\</span>
  --repository<span class="o">=</span>&lt;repo-name&gt; <span class="se">\</span>
  --branch<span class="o">=</span>&lt;organization default branch&gt; <span class="se">\</span>
  --team<span class="o">=</span>&lt;team1-slug&gt; <span class="se">\</span>
  --team<span class="o">=</span>&lt;team2-slug&gt; <span class="se">\</span>
  --path<span class="o">=</span>staging-cluster
</code></pre></div>
<p>Example output:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> flux bootstrap github --owner<span class="o">=</span>gitopsrun --repository<span class="o">=</span>fleet-infra --path<span class="o">=</span>staging-cluster --team<span class="o">=</span>devs
<span class="go">► connecting to github.com</span>
<span class="go">✔ repository created</span>
<span class="go">✔ devs team access granted</span>
<span class="go">✔ repository cloned</span>
<span class="go">✚ generating manifests</span>
<span class="go">✔ components manifests pushed</span>
<span class="go">► installing components in flux-system namespace</span>
<span class="go">deployment &quot;source-controller&quot; successfully rolled out</span>
<span class="go">deployment &quot;kustomize-controller&quot; successfully rolled out</span>
<span class="go">deployment &quot;helm-controller&quot; successfully rolled out</span>
<span class="go">deployment &quot;notification-controller&quot; successfully rolled out</span>
<span class="go">✔ install completed</span>
<span class="go">► configuring deploy key</span>
<span class="go">✔ deploy key configured</span>
<span class="go">► generating sync manifests</span>
<span class="go">✔ sync manifests pushed</span>
<span class="go">► applying sync manifests</span>
<span class="go">◎ waiting for cluster sync</span>
<span class="go">✔ bootstrap finished</span>
</code></pre></div>
<p>If you prefer GitLab, export <code>GITLAB_TOKEN</code> env var and use the command <a href="../cmd/flux_bootstrap_gitlab/">flux bootstrap gitlab</a>.</p>
<div class="admonition hint">
<p class="admonition-title">Idempotency</p>
<p>It is safe to run the bootstrap command as many times as you want.
If the Flux components are present on the cluster,
the bootstrap command will perform an upgrade if needed.
You can target a specific Flux <a href="https://github.com/fluxcd/flux2/releases">version</a>
with <code>flux bootstrap --version=&lt;semver&gt;</code>.</p>
</div>
<h2 id="staging-workflow">Staging workflow<a class="headerlink" href="#staging-workflow" title="Permanent link">&para;</a></h2>
<p>Clone the repository with:</p>
<div class="highlight"><pre><span></span><code>git clone https://github.com/<span class="nv">$GITHUB_USER</span>/fleet-infra
<span class="nb">cd</span> fleet-infra
</code></pre></div>
<p>Create a git source pointing to a public repository master branch:</p>
<div class="highlight"><pre><span></span><code>flux create <span class="nb">source</span> git webapp <span class="se">\</span>
  --url<span class="o">=</span>https://github.com/stefanprodan/podinfo <span class="se">\</span>
  --branch<span class="o">=</span>master <span class="se">\</span>
  --interval<span class="o">=</span>30s <span class="se">\</span>
  --export &gt; ./staging-cluster/webapp-source.yaml
</code></pre></div>
<p>Create a kustomization for synchronizing the common manifests on the cluster:</p>
<div class="highlight"><pre><span></span><code>flux create kustomization webapp-common <span class="se">\</span>
  --source<span class="o">=</span>webapp <span class="se">\</span>
  --path<span class="o">=</span><span class="s2">&quot;./deploy/webapp/common&quot;</span> <span class="se">\</span>
  --prune<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --validation<span class="o">=</span>client <span class="se">\</span>
  --interval<span class="o">=</span>1h <span class="se">\</span>
  --export &gt; ./staging-cluster/webapp-common.yaml
</code></pre></div>
<p>Create a kustomization for the backend service that depends on common:</p>
<div class="highlight"><pre><span></span><code>flux create kustomization webapp-backend <span class="se">\</span>
  --depends-on<span class="o">=</span>webapp-common <span class="se">\</span>
  --source<span class="o">=</span>webapp <span class="se">\</span>
  --path<span class="o">=</span><span class="s2">&quot;./deploy/webapp/backend&quot;</span> <span class="se">\</span>
  --prune<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --validation<span class="o">=</span>client <span class="se">\</span>
  --interval<span class="o">=</span>10m <span class="se">\</span>
  --health-check<span class="o">=</span><span class="s2">&quot;Deployment/backend.webapp&quot;</span> <span class="se">\</span>
  --health-check-timeout<span class="o">=</span>2m <span class="se">\</span>
  --export &gt; ./staging-cluster/webapp-backend.yaml
</code></pre></div>
<p>Create a kustomization for the frontend service that depends on backend:</p>
<div class="highlight"><pre><span></span><code>flux create kustomization webapp-frontend <span class="se">\</span>
  --depends-on<span class="o">=</span>webapp-backend <span class="se">\</span>
  --source<span class="o">=</span>webapp <span class="se">\</span>
  --path<span class="o">=</span><span class="s2">&quot;./deploy/webapp/frontend&quot;</span> <span class="se">\</span>
  --prune<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --validation<span class="o">=</span>client <span class="se">\</span>
  --interval<span class="o">=</span>10m <span class="se">\</span>
  --health-check<span class="o">=</span><span class="s2">&quot;Deployment/frontend.webapp&quot;</span> <span class="se">\</span>
  --health-check-timeout<span class="o">=</span>2m <span class="se">\</span>
  --export &gt; ./staging-cluster/webapp-frontend.yaml
</code></pre></div>
<p>Push changes to origin:</p>
<div class="highlight"><pre><span></span><code>git add -A <span class="o">&amp;&amp;</span> git commit -m <span class="s2">&quot;add staging webapp&quot;</span> <span class="o">&amp;&amp;</span> git push
</code></pre></div>
<p>In about 30s the synchronization should start:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> watch flux get kustomizations
<span class="go">NAME            READY   MESSAGE</span>
<span class="go">flux-system     True    Applied revision: main/6eea299fe9997c8561b826b67950afaf9a476cf8</span>
<span class="go">webapp-backend  False   dependency &#39;flux-system/webapp-common&#39; is not ready</span>
<span class="go">webapp-common   True    Applied revision: master/7411da595c25183daba255068814b83843fe3395</span>
<span class="go">webapp-frontend False   dependency &#39;flux-system/webapp-backend&#39; is not ready</span>
</code></pre></div>
<p>When the synchronization finishes you can check that the webapp services are running:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> kubectl -n webapp get deployments,services
<span class="go">NAME                       READY   UP-TO-DATE   AVAILABLE   AGE</span>
<span class="go">deployment.apps/backend    1/1     1            1           4m1s</span>
<span class="go">deployment.apps/frontend   1/1     1            1           3m31s</span>

<span class="go">NAME               TYPE        CLUSTER-IP    EXTERNAL-IP   PORT(S)             AGE</span>
<span class="go">service/backend    ClusterIP   10.52.10.22   &lt;none&gt;        9898/TCP,9999/TCP   4m1s</span>
<span class="go">service/frontend   ClusterIP   10.52.9.85    &lt;none&gt;        80/TCP              3m31s</span>
</code></pre></div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>From this moment forward, any changes made to the webapp
Kubernetes manifests in the master branch will be synchronised with the staging cluster.</p>
</div>
<p>If a Kubernetes manifest is removed from the webapp repository, the reconciler will remove it from your cluster.
If you delete a kustomization from the <code>fleet-infra</code> repo, the reconciler will remove all Kubernetes objects that
were previously applied from that kustomization.</p>
<p>If you alter the webapp deployment using <code>kubectl edit</code>, the changes will be reverted to match
the state described in git. When dealing with an incident, you can pause the reconciliation of a
kustomization with <code>flux suspend kustomization &lt;name&gt;</code>. Once the debugging session
is over, you can re-enable the reconciliation with <code>flux resume kustomization &lt;name&gt;</code>.</p>
<h2 id="production-bootstrap">Production bootstrap<a class="headerlink" href="#production-bootstrap" title="Permanent link">&para;</a></h2>
<p>On production clusters, you may wish to deploy stable releases of an application.
When creating a git source instead of a branch, you can specify a git tag or a semver expression. </p>
<p>Create the production cluster using Kubernetes kind or set the kubectl context to an existing cluster:</p>
<div class="highlight"><pre><span></span><code>kind create cluster --name production
kubectl cluster-info --context kind-production
</code></pre></div>
<p>Run the bootstrap for the production environment:</p>
<p><div class="highlight"><pre><span></span><code>flux bootstrap github <span class="se">\</span>
  --owner<span class="o">=</span><span class="nv">$GITHUB_USER</span> <span class="se">\</span>
  --repository<span class="o">=</span>fleet-infra <span class="se">\</span>
  --path<span class="o">=</span>prod-cluster <span class="se">\</span>
  --personal
</code></pre></div>
Pull the changes locally:</p>
<div class="highlight"><pre><span></span><code>git pull
</code></pre></div>
<h2 id="production-workflow">Production workflow<a class="headerlink" href="#production-workflow" title="Permanent link">&para;</a></h2>
<p>Create a git source using a semver range to target stable releases:</p>
<div class="highlight"><pre><span></span><code>flux create <span class="nb">source</span> git webapp <span class="se">\</span>
  --url<span class="o">=</span>https://github.com/stefanprodan/podinfo <span class="se">\</span>
  --tag-semver<span class="o">=</span><span class="s2">&quot;&gt;=4.0.0 &lt;4.0.2&quot;</span> <span class="se">\</span>
  --interval<span class="o">=</span>30s <span class="se">\</span>
  --export &gt; ./prod-cluster/webapp-source.yaml
</code></pre></div>
<p>Create a kustomization for webapp pointing to the production overlay:</p>
<div class="highlight"><pre><span></span><code>flux create kustomization webapp <span class="se">\</span>
  --source<span class="o">=</span>webapp <span class="se">\</span>
  --path<span class="o">=</span><span class="s2">&quot;./deploy/overlays/production&quot;</span> <span class="se">\</span>
  --prune<span class="o">=</span><span class="nb">true</span> <span class="se">\</span>
  --validation<span class="o">=</span>client <span class="se">\</span>
  --interval<span class="o">=</span>10m <span class="se">\</span>
  --health-check<span class="o">=</span><span class="s2">&quot;Deployment/frontend.production&quot;</span> <span class="se">\</span>
  --health-check<span class="o">=</span><span class="s2">&quot;Deployment/backend.production&quot;</span> <span class="se">\</span>
  --health-check-timeout<span class="o">=</span>2m <span class="se">\</span>
  --export &gt; ./prod-cluster/webapp-production.yaml
</code></pre></div>
<p>Push changes to origin:</p>
<div class="highlight"><pre><span></span><code>git add -A <span class="o">&amp;&amp;</span> git commit -m <span class="s2">&quot;add prod webapp&quot;</span> <span class="o">&amp;&amp;</span> git push
</code></pre></div>
<p>List git sources:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> flux get sources git
<span class="go">NAME            REVISION                                        READY   MESSAGE</span>
<span class="go">flux-system     main/5ae055e24b2c8a78f981708b61507a97a30bd7a6   True    Fetched revision: main/113360052b3153e439a0cf8de76b8e3d2a7bdf27</span>
<span class="go">webapp          4.0.1/113360052b3153e439a0cf8de76b8e3d2a7bdf27  True    Fetched revision: 4.0.1/113360052b3153e439a0cf8de76b8e3d2a7bdf27</span>
</code></pre></div>
<p>The kubectl equivalent is <code>kubectl -n flux-system get gitrepositories</code>.</p>
<p>List kustomization:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> flux get kustomizations
<span class="go">NAME            REVISION                                        SUSPENDED       READY   MESSAGE</span>
<span class="go">flux-system     main/5ae055e24b2c8a78f981708b61507a97a30bd7a6   False           True    Applied revision: main/5ae055e24b2c8a78f981708b61507a97a30bd7a6</span>
<span class="go">webapp          4.0.1/113360052b3153e439a0cf8de76b8e3d2a7bdf27  False           True    Applied revision: 4.0.1/113360052b3153e439a0cf8de76b8e3d2a7bdf27</span>
</code></pre></div>
<p>The kubectl equivalent is <code>kubectl -n flux-system get kustomizations</code>.</p>
<p>If you want to upgrade to the latest 4.x version, you can change the semver expression to:</p>
<div class="highlight"><pre><span></span><code>flux create <span class="nb">source</span> git webapp <span class="se">\</span>
  --url<span class="o">=</span>https://github.com/stefanprodan/podinfo <span class="se">\</span>
  --tag-semver<span class="o">=</span><span class="s2">&quot;&gt;=4.0.0 &lt;5.0.0&quot;</span> <span class="se">\</span>
  --interval<span class="o">=</span>30s <span class="se">\</span>
  --export &gt; ./prod-cluster/webapp-source.yaml

git add -A <span class="o">&amp;&amp;</span> git commit -m <span class="s2">&quot;update prod webapp&quot;</span> <span class="o">&amp;&amp;</span> git push
</code></pre></div>
<p>Trigger a git sync:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> flux reconcile ks flux-system --with-source 
<span class="go">► annotating source flux-system</span>
<span class="go">✔ source annotated</span>
<span class="go">◎ waiting for reconcilitation</span>
<span class="go">✔ git reconciliation completed</span>
<span class="go">✔ fetched revision main/d751ea264d48bf0db8b588d1d08184834ac8fec9</span>
<span class="go">◎ waiting for kustomization reconcilitation</span>
<span class="go">✔ kustomization reconcilitation completed</span>
<span class="go">✔ applied revision main/d751ea264d48bf0db8b588d1d08184834ac8fec9</span>
</code></pre></div>
<p>The kubectl equivalent is <code>kubectl -n flux-system annotate gitrepository/flux-system fluxcd.io/reconcileAt="$(date +%s)"</code>.</p>
<p>Wait for the webapp to be upgraded:</p>
<div class="highlight"><pre><span></span><code><span class="gp">$</span> watch flux get kustomizations
<span class="go">NAME            REVISION                                        SUSPENDED       READY   MESSAGE</span>
<span class="go">flux-system     main/d751ea264d48bf0db8b588d1d08184834ac8fec9   False           True    Applied revision: main/d751ea264d48bf0db8b588d1d08184834ac8fec9</span>
<span class="go">webapp          4.0.6/26a630c0b4b3452833d96c511d93f6f2d2e90a99  False           True    Applied revision: 4.0.6/26a630c0b4b3452833d96c511d93f6f2d2e90a99</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href=".." class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Introduction
              </div>
            </div>
          </a>
        
        
          <a href="../guides/installation/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Installation
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.0ac82a11.min.js"></script>
      <script src="../assets/javascripts/bundle.f81dfb4d.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>